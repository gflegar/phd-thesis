%%%% Required: template setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% basic document setup
\documentclass[final,a4paper,11pt,twoside]{book}
\usepackage[left=1cm,right=1cm,top=2cm,bottom=2cm,head=26pt]{geometry}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{mathptmx}
\usepackage[scaled]{helvet}  % fix size of helvetica fonts
\usepackage[square,sort,comma,numbers]{natbib}
% \usepackage[colorlinks=false]{hyperref}

% Paper inclusion
\usepackage[sectionbib]{bibunits}
\usepackage{color}
\usepackage{import}
\usepackage{suffix}
\usepackage{verbatimcopy}

% NOTE: There is an issue with interoperability between import and bibunits (and
% probably between import and citations in general), where, due to import's
% mangling of input file paths (but not of output file paths), temporary files
% get written to the top-level directory, but are then expected inside the child
% directory.
%
% To fix this issue, auxiliary files generated by bibunits are also copied to
% the appropriate subfolder using the verbatimcopy package.

% Includes a chapter from a subfolder
\newcommand\includechapter[2]{
    \chapter{#2}
    \begin{bibunit}[plain]
    \import*{#1/}{body}
    \putbib[#1/references]
    \end{bibunit}
}

% Includes an unnamed chapter from a subfolder, and without a reference section
\WithSuffix\newcommand\includechapter*[2]{
    \chapter*{#2}
    \import*{#1/}{body}
}

\makeatletter

% includes a paper from a subfolder
\newcommand\includepaper[4]{
    \chapter{#2}
    \begin{bibunit}[plain]
    \begin{quote}
        \textcolor{blue}{\footnotesize
            #3.\\
            {\em #2}.\\
            #4.\\
        }
    \end{quote}
    \section*{Abstract}
    \import*{#1/}{abstract}
    \import*{#1/}{body}
    \putbib[#1/references]
    \end{bibunit}
    % make sure that the bibliography files are written into the subfolder
    \OldVerbatimCopy{\@bibunitname.aux}{#1/\@bibunitname.aux}
}

\makeatother

% frontmatter dependencies
\usepackage{titling}
\usepackage{graphicx}
\newcommand{\advisor}[1]{\def \theadvisor {#1}}
\newcommand{\coadvisor}[1]{\def \thecoadvisor {#1}}

% TOC setup
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4} 

% Header and footer setup
\usepackage{fancyhdr}
\fancyhf{}
\renewcommand\chaptermark[1]{\markboth{Chapter \thechapter. #1}{}}
\renewcommand\sectionmark[1]{\markright{\thesection. #1}{}}
\renewcommand\headrulewidth{0.2pt}
\renewcommand\footrulewidth{0.1pt}
\fancyfoot[LE,RO]{\thepage} 
\fancyhead[LO]{{\sffamily \rightmark}}
\fancyhead[RE]{{\sffamily \leftmark}}

% Chapter setup
\usepackage[Bjornstrup]{fncychap}
% solve a bug in Bjornstrup, see: https://tex.stackexchange.com/a/89786/160826
\makeatletter
  \renewcommand{\DOCH}{%
    \settowidth{\py}{\CNoV\thechapter}%
    \addtolength{\py}{-10pt}%
    \fboxsep=0pt%
    \colorbox[gray]{.85}{\rule{0pt}{40pt}\parbox[b]{\textwidth}{\hfill}}%
    \kern-\py\raise20pt%
    \hbox{\color[gray]{.5}\CNoV\thechapter}%
    \kern-\myhi%
    \\%
  }
\makeatother
% The original font used for chapter numbers by Bjornstrup is not available,
% use the ptm font from mathptmx
\ChNumVar{\fontsize{76}{80}\usefont{T1}{ptm}{m}{it}\selectfont}

% If you need to debug the layout, uncomment the following two lines:
% \usepackage{showframe}
% \usepackage{layout}
\providecommand{\layout}{}

%%%% Optional: additional packages and configurations
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% AMS mathematics
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\newtheorem{defi}{\textit{\textbf{Definition}}}[chapter]
\newtheorem{prop}{\textit{\textbf{Proposition}}}[chapter]
\newtheorem{coro}{\textit{\textbf{Corollary}}}[chapter]
\newtheorem{lema}{\textit{\textbf{Lema}}}[chapter]
\newtheorem{theo}{\textit{\textbf{Theorem}}}[chapter]

% Listings
\usepackage{listings}

\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}
\lstset{language=matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}
\lstset{language=C,
basicstyle=\scriptsize\tt,
numbers=left,                   % where to put the line-numbers
numberstyle=\scriptsize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it's 1, each line  numbered
numbersep=5pt,
stringstyle=\scriptsize\tt,
identifierstyle=\scriptsize\tt,
commentstyle=\scriptsize\em,
keywordstyle=\scriptsize\bf,
breaklines,frameround=ffff,frame=trbl,captionpos=b}

% Other utilities
\usepackage{booktabs}   % improved tables
\usepackage{float}      % improved float behavior
\usepackage{lscape}     % landscape pages
\usepackage{multirow}   % table cells spanning multiple rows
\usepackage{xspace}     % \xspace command - prevents eating spaces
\usepackage{url}        % \url command
\usepackage{adjustbox}  % \adjustbox evnironment

\input{macros}

\begin{document}

\layout{}

\frontmatter
\pagestyle{plain}

% Change the information about your thesis here:
\title{Accelerating the Solution of Sparse Linear Systems on Graphics
       Processing Units}
\author{Goran Flegar}
\advisor{Enrique S. Quintana-Ort\'{i}}
\coadvisor{Hartwig Anzt}
\date{March 2019}
%%%%

\input{cover}

\tableofcontents
\cleardoublepage

\includechapter*{abstract}{Abstract}

\includechapter*{acknowledgements}{Acknowledgements}

\mainmatter
\pagestyle{fancy}

\part{Introduction}

\includechapter{introduction}{Introduction}

\part{Sparse Matrix Formats and Matrix-Vector Product}

\includepaper{2017-csr-spmv}
    {Balanced CSR Sparse Matrix-Vector Product on Graphics Processors}
    {\textbf{G.~Flegar}, E.~S.~Quintana-Ort\'{i}}
    {In Proceedings of Euro-Par 2017: Parallel Processing, pp. 697--709, 2017.
    DOI: 10.1007/978-3-319-64203-1\_50}

\includepaper{2017-coo-spmv}
    {Overcoming Load Imbalance for Irregular Sparse Matrices}
    {\textbf{G.~Flegar}, H.~Anzt}
    {In Proceedings of the Seventh Workshop on Irregular Applications:
    Architectures and Algorithms (IA3'17), pp. 2:1--2:8, 2017.
    DOI: 10.1145/3149704.3149767}

\includepaper{2017-batched-spmv}
    {Flexible Batched Sparse Matrix-Vector Product on GPUs}
    {H.~Anzt, G.~Colins, J.~Dongarra, \textbf{G.~Flegar},
    E.~S.~Qunitana-Ort\'{i}}
    {In Proceedings of the 8th Workshop on Latest Advances in Scalable
    Algorithms for Large-Scale Systems (ScalA'17), pp. 3:1--3:8, 2017.
    DOI: 10.1145/3148226.3148230}

\part{Preconditioning}

\includepaper{2017-gje-block-jacobi}
    {Variable-Size Batched Gauss-Jordan Elimination for Block-Jacobi
    Preconditioning on Graphics Processors}
    {H.~Anzt, J.~Dongarra, \textbf{G.~Flegar}, E.~S.~Quintana-Ort\'{i}}
    {Parallel Computing, Vol 81, pp. 131--146, 2019.
    DOI: 10.1016/j.parco.2017.12.006}

\includepaper{2017-gh-block-jacobi}
    {Variable-Size Batched Gauss-Huard for Block-Jacobi Preconditioning}
    {H.~Anzt, J.~Dongarra, \textbf{G.~Flegar}, E.~S.~Qunitana-Ort\'{i},
     A.~E.~Tom\'{a}s}
    {Procedia Computer Science, Vol 108, pp. 1783--1792, 2017.
    DOI: 10.1016/j.procs.2017.05.186}


\part{Towards Low Precision Methods}

\part{Conclusion}

\includechapter{conclusion}{Conclusions and Open Research Directions}

\appendix

\backmatter
\pagestyle{plain}

\listoffigures
\addcontentsline{toc}{chapter}{List of Figures}
\cleardoublepage

\listoftables
\addcontentsline{toc}{chapter}{List of Tables}
\cleardoublepage

\end{document}
